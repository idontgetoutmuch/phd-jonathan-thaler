\section{Case Study 2: Sugarscape (Second Encounter)}
One of the first  Agent-Based Simulation model which rose to some prominence was the Sugarscape model developed by Epstein and Axtell in 1996 \cite{epstein_growing_1996}. Their aim was to \textit{grow} an artificial society by simulation and connect observations in their simulation to phenomenon of real-world societies. The main features of this model are:

\begin{itemize}
	\item Searching, harvesting and consuming of resources.
	\item Wealth and age distributions.
	\item Seasons in the environment and migration of agents.
	\item Pollution of the environment.
	\item Population dynamics under sexual reproduction.
	\item Cultural processes and transmission.
	\item Combat and assimilation.
	\item Bilateral decentralized trading (bartering) between agents with endogenous demand and supply.
	\item Emergent Credit-Networks.
	\item Disease Processes, Transmission and immunology.
\end{itemize}

Because of its essential importance to this field, its complexity, number of features and allowing us to bridge the gap to ACE, we select it as the first of two central models, which will serve as use-case to develop our methods. The idea is to formally specify and then verify the process of bilateral decentralized trading because it is the most complex of the features and connects directly to ACE.

We implemented Chapter II of the book. TODO: shortly explain how agents behave

The model specification requires to shuffle agents before every step. This happens automatically due to race-conditions in concurrency we arrive at an effectively shuffled processing of agents: we can assume that the order of the agents is \textit{effectively} random in every step - with the important difference, that we do not have control over this randomness as we would have when shuffling.

Note that in contrast to the SIR case-study we don't provide an IO implementation because we focus on different thing here. 

TODO: we compete with \cite{lysenko_framework_2008}

TODO: implement Data-Flow between Agents: pure in State and using TChan in STM / IO
TODO: implement Sugarscape TArray
TODO: compare RePast or other Java Sugarscape Performance

\begin{itemize}
	\item State - 
	\item STM TVar -
	\item STM TArray -
	\item STM TArray Environment non-concurrent -
\end{itemize}

\subsection{Experiment Design}
We follow \cite{lysenko_framework_2008} and measure the average updates per second of the simulation with a 128x128 environment and an initial population for 500, over 60 seconds. For each experiment we conducted 8 runs on our machine (see Table \ref{tab:machine_specs}) under no additional work-load and report both the average and standard deviation. In the experiments we varied the number of agents and the number of cores when running concurrently - the numbers are always indicated clearly. For varying the number of cores we compiled the executable using \textit{stack} and the \textit{threaded} option and executed it with \textit{stack} using the \textit{+RTS -Nx} option where x is the number of cores between 1 and 4. 

TODO main measure: up/sec and retry-ratio

\subsection{Naive Approach}
Experiments with varying number of cores. The results are reported in Table \ref{tab:naive_stm_results}.

\begin{table}
	\centering
  	\begin{tabular}{ c || c | c | c }
               & Cores & Steps in 60 sec & Ratio per sec \\ \hline \hline 
    	State  & 1     & 12              & 0.2   \\ \hline \hline
   		STM    & 1     & 11              & 0.18  \\ \hline
   		STM    & 2     & TODO            &       \\ \hline
   		STM    & 3     & TODO            &       \\ \hline
   		STM    & 4     & TODO            &       \\ \hline \hline
   		RePast & 1     & N/A             & 17    \\ \hline \hline
   		GPU    & N/A   & N/A             & 2000  \\ \hline \hline
   	\end{tabular}
  	
  	\caption{Experiments with varying number of cores.}
	\label{tab:naive_stm_results}
\end{table}

We also compared the retry-ratio on varying number of cores.

\begin{table}
	\centering
  	\begin{tabular}{ c || c | c | c }
        Cores & Commits & Retries & Ratio \\ \hline \hline 
    	1     & TODO              & 0.2   \\ \hline \hline
   		2     & TODO              & 0.18  \\ \hline
   		3     & TODO              &       \\ \hline
   		4     & TODO              &       \\ \hline
   	\end{tabular}
  	
  	\caption{Experiments on constant 51x51 (2,601 agents) grid with varying number of cores.}
	\label{tab:constgrid_varyingcores}
\end{table}

\subsection{From TVar to TArray}

\subsection{Running Environment non-concurrently}

\subsection{Conclusions}